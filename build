#!/usr/bin/env bash

# This script generates index.html from README.md

get_chunk() {
    sed -n "/\`\`\`${1}/,/\`\`\`/p" | sed '1d;$d'
}

min_code() {
    sed 's/\/\/.*$//' | tr '\n' ' ' | sed 's/ //g' | sed 's/letx/let x/'
}

min_html() {
    grep -v '<!--'
}

print_output() {
    local css="$(cat README.md | get_chunk css | min_code)"
    local html="$(cat README.md | get_chunk html | min_html)"
    local js="$(cat README.md | get_chunk javascript | min_code)"

    printf %s "$html<script>$js</script><style>$css"
}

print_output > index.html
